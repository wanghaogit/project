ec.pkg("ec.member.orderList");ec.load("ajax");ec.load("ec.box",{loadType:"lazy"});ec.load("jquery.movebar");ec.member.orderList.openAddRemarkView=function(a){$.ajax({url:domainRemark+"/remark/addUserRemarkView?orderInfo="+a+"&t="+new Date().getTime(),dataType:"jsonp",success:function(c){var d=$(c);if(d.length==1&&d.hasClass("errorMsg")){var b=encodeURIComponent(d.text());window.location.href="/member/prdRemark/errorMsg?msg="+b}else{$("div.u-4-5").html(c);ec.member.add.showView()}}})};ec.member.orderList.getUserOrderRemarkStatus=function(d){var b="";var c=true;$(".button-operate-revie").each(function(){if(c){b=$(this).attr("orderInfo");c=false}else{b+=","+$(this).attr("orderInfo")}});if(b!=""){var a=0;if(d!=""){a=1}new ec.ajax().get({url:domainRemark+"/remark/queryUserOrderRemarkStatus.json?t="+new Date().getTime(),dataType:"jsonp",data:{orderInfo:b,dataType:a},timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(e){$(".button-operate-revie").each(function(){var k;var j=$(this).attr("orderInfo");for(var h=0;h<e.RemarkStatus.length;h++){k=e.RemarkStatus[h];var g=k.orderId+"-"+k.orderStatus;if((j==g)&&(k.remarkStatus==1)){var f=k.orderId;if(d){f=k.orderId+"&isHisData=1"}$(this).attr("href",domainRemark+"/remark/addUserRemarkView?orderInfo="+f).click(function(){window.location.hash=f;return false});$(this).attr("title","\u6211\u8981\u8bc4\u8bba");$(this).attr("innerHTML","<span>\u6211\u8981\u8bc4\u8bba</span>");$(this).parent(".p-button").removeClass("hide")}}})}})}};ec.ready(function(){$("#li-order").addClass("current");$("#pathTitle").html("\u6211\u7684\u8ba2\u5355");ec.member.orderList.interfaceTpl=new ec.template($("#interface-tpl").val());window.onhashchange=function(){var b=window.location.hash;if(b&&b.length>0){b=b.substring(1,b.length);if(b.length>0){ec.member.orderList.openAddRemarkView(b)}else{window.location.reload()}}else{window.location.reload()}};var a=window.location.hash;if(a&&a.length>0){a=a.substring(1,a.length);if(a.length>0){ec.member.orderList.openAddRemarkView(a);return}}});ec.member.orderList.load=function(c){var b,a;if($("#checkid").val()=="nocomment"){b=domainRemark+"/remark/queryUserNotRemarkOrderList.json?t="+new Date().getTime();a="jsonp"}else{b=domainMain+"/member/order.json?t="+new Date().getTime();a="json"}new ec.ajax().get({url:b,dataType:a,data:{dateType:$("#colid").val(),tab:$("#checkid").val(),pageNumber:c.pageNumber,pageSize:5},timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(d){if(!d.success){alert("\u5f88\u62b1\u6b49\uff01\u8ba2\u5355\u5217\u8868\u67e5\u8be2\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u65b0\u64cd\u4f5c");return}ec.member.orderList.push(d)}})};ec.member.orderList.push=function(j){var e=[],b,h,f=$("#colid").val(),c="",g="",a="";if(j.orderList&&j.orderList.length>0){for(var d=0;d<j.orderList.length;d++){b=j.orderList[d];h=(f==1&&b.isHisData==1)?"?isHisData=1":"",a=(b.paymentStatus==1)?"\u5df2\u4ed8\u6b3e":"\u5f85\u652f\u4ed8";if(b.orderStatus=="4"||b.orderStatus=="8"){c=(new Date(b.orderDate)).format("yyyy-MM-dd")+"&nbsp;&nbsp;"+(new Date(b.orderDate)).format("HH:mm");g=a}else{if(b.orderStatus=="7"){c=(new Date(b.orderDate)).format("yyyy-MM-dd")+"&nbsp;&nbsp;"+(new Date(b.orderDate)).format("HH:mm");g=b.orderStatusText+"&nbsp;|&nbsp;"+a}else{c=(new Date(b.orderDate)).format("yyyy-MM-dd")+"&nbsp;&nbsp;"+(new Date(b.orderDate)).format("HH:mm");g=(b.orderStatus=="6")?a:(b.orderStatusText+"&nbsp;|&nbsp;"+a)}}e.push('<div class="list-group-item"><div class="o-info">');if(b.orderStatus==8){e.push('<div class="col-info">');if((b.paymentStatus==2||b.paymentStatus==3)&&(b.orderStatus==3||(b.orderStatus<3&&b.orderSource!=2))){e.push('<input type="checkbox" class="checkbox" name="payCheck" paymentStatus="'+b.paymentStatus+'" value="'+b.orderCode+'"/>')}e.push('<span class="o-date">'+c+'</span><span class="o-no">\u8ba2\u5355\u53f7\uff1a');e.push('<a href="/member/order-'+b.orderCode+h+'" title="'+b.orderCode+'">'+b.orderCode+'</a></span></div><div class="col-state">');if(b.paymentStatus==1){e.push("\u5df2\u4ed8\u6b3e")}else{if(b.paymentStatus==2){e.push("\u5df2\u53d6\u6d88")}else{if(b.paymentStatus==3){if(b.type==18){e.push("\u5df2\u652f\u4ed8\u8ba2\u91d1")}else{e.push("\u5df2\u90e8\u5206\u4ed8\u6b3e")}}else{e.push("\u5f85\u652f\u4ed8")}}}e.push("</div>")}else{if(b.orderStatus==7){e.push('<div class="col-info">');if((b.paymentStatus==2||b.paymentStatus==3)&&(b.orderStatus==3||(b.orderStatus<3&&b.orderSource!=2))){e.push('<input type="checkbox" class="checkbox" name="payCheck" paymentStatus="'+b.paymentStatus+'" value="'+b.orderCode+'"/>')}e.push('<span class="o-date">'+c+'</span><span class="o-no">\u8ba2\u5355\u53f7\uff1a');e.push('<a href="/member/order-'+b.orderCode+h+'" title="'+b.orderCode+'">'+b.orderCode+"</a></span>");e.push('<span class="o-logistics">');e.push('<a href="javascript:;" onmouseover="ec.member.orderList.openLog(this, '+b.orderCode+')">\u7269\u6d41\u4fe1\u606f</a>');e.push('<div class="o-logistics-record" id="interface-dialog-'+b.orderCode+'">');e.push('<div class="o-logistics-list" id="interface-msg-'+b.orderCode+'">');e.push('<div class="o-logistics-list-loading">\u52a0\u8f7d\u4e2d</div></div><s></s></div></span></div><div class="col-state">'+b.orderStatusText+"&nbsp;|&nbsp;");if(b.paymentStatus==1){e.push("\u5df2\u4ed8\u6b3e")}else{if(b.paymentStatus==2){e.push("\u5df2\u53d6\u6d88")}else{e.push("\u5f85\u652f\u4ed8")}}e.push("</div>")}else{e.push('<div class="col-info">');if((b.paymentStatus==2||b.paymentStatus==3)&&(b.orderStatus==3||(b.orderStatus<3&&b.orderSource!=2))){e.push('<input type="checkbox" class="checkbox" name="payCheck" paymentStatus="'+b.paymentStatus+'" value="'+b.orderCode+'"/>')}e.push('<span class="o-date">'+c+'</span><span class="o-no">\u8ba2\u5355\u53f7\uff1a');e.push('<a href="/member/order-'+b.orderCode+h+'" title="'+b.orderCode+'">'+b.orderCode+"</a></span>");if(b.orderStatus==6){e.push('<span class="o-logistics">');e.push('<a href="javascript:;" onmouseover="ec.member.orderList.openLog(this, '+b.orderCode+')">\u7269\u6d41\u4fe1\u606f</a>');e.push('<div class="o-logistics-record" id="interface-dialog-'+b.orderCode+'">');e.push('<div class="o-logistics-list" id="interface-msg-'+b.orderCode+'">');e.push('<div class="o-logistics-list-loading">\u52a0\u8f7d\u4e2d</div></div><s></s></div></span>')}e.push('</div><div class="col-state">');if(b.orderStatus==4){e.push("\u5ba1\u6838\u672a\u901a\u8fc7&nbsp;|&nbsp;")}else{if(b.orderStatus==12){e.push("\u5173\u95ed\u652f\u4ed8&nbsp;|&nbsp;")}else{if(b.orderStatus==6){e.push("\u7b49\u5f85\u6536\u8d27\u786e\u8ba4&nbsp;|&nbsp;")}else{e.push(b.orderStatusText+"&nbsp;|&nbsp;")}}}if(b.paymentStatus==1){e.push("\u5df2\u4ed8\u6b3e")}else{if(b.paymentStatus==3){e.push("\u5df2\u90e8\u5206\u4ed8\u6b3e")}else{e.push("\u5f85\u652f\u4ed8")}}e.push("</div>")}}e.push('</div><div class="o-pro"><table border="0" cellpadding="0" cellspacing="0"><tbody>');e.push(ec.member.orderList.productList(b));e.push("</tbody></table></div>");if(b.type==18){e.push(ec.member.orderList.depositList(b))}e.push("</div>")}$("#list-group").html(e.join(""));if($("#checkid").val()=="nocomment"){ec.member.orderList.loadImg(j)}ec.member.orderList.bottomCheckBoxDisplay(true);ec.member.orderList.renderPage(j.page);ec.ui.scrollTo("#myOrder-cate")}else{ec.member.orderList.bottomCheckBoxDisplay(false);$("#list-group").html('<div class="list-group-empty">\u60a8\u6682\u65f6\u6ca1\u6709\u76f8\u5173\u8bb0\u5f55\u3002</div>');$("#list-pager").html("")}ec.member.orderList.getUserOrderRemarkStatus(h);ec.member.orderList.payClick()};ec.member.orderList.loadImg=function(d){var c=[];for(var f=0;f<d.orderList.length;f++){for(var e=0;e<d.orderList[f].productList.length;e++){c.push(d.orderList[f].productList[e].skuCode);for(var b=0;b<d.orderList[f].productList[e].giftList.length;b++){c.push(d.orderList[f].productList[e].giftList[b].giftSkuCode)}}for(var e=0;e<d.orderList[f].bundlerList.length;e++){for(var b=0;b<d.orderList[f].bundlerList[e].productList.length;b++){c.push(d.orderList[f].bundlerList[e].productList[b].skuCode);for(var a=0;a<d.orderList[f].bundlerList[e].productList[b].giftList.length;a++){c.push(d.orderList[f].bundlerList[e].productList[b].giftList[a].giftSkuCode)}}}}new ec.ajax().get({url:domainMain+"/product/queryInfoBySkucode.json?t="+new Date().getTime()+"&skuCode="+c.join("&skuCode="),async:false,timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(h){if(!h.success){alert("\u5f88\u62b1\u6b49\uff01\u5546\u54c1\u56fe\u7247\u67e5\u8be2\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u65b0\u64cd\u4f5c");return}for(var g=0;g<h.data.length;g++){$(".nocomment-"+h.data[g].skuCode).attr("src",ec.mediaPath+"/"+h.data[g].photoPath+"100_100_"+h.data[g].photoName).attr("alt",h.data[g].name);$(".nocomment-"+h.data[g].skuCode).parent("a").attr("href","/product/"+h.data[g].prdId+".html#"+h.data[g].skuId);$(".nocomment-"+h.data[g].skuCode).attr("href","/product/"+h.data[g].prdId+".html#"+h.data[g].skuId);if($(".pl-"+h.data[g].skuCode).html()){$(".pl-"+h.data[g].skuCode).attr("orderinfo",$(".pl-"+h.data[g].skuCode).attr("orderinfo").replace("${proId}",h.data[g].prdId))}}}})};ec.member.orderList.bottomCheckBoxDisplay=function(a){if(a){$("#myOrder-control-bottom").show();$("#bottomCheckAllBox").attr("checked",false)}else{$("#myOrder-control-bottom").hide()}};ec.member.orderList.productList=function(l){var r=[],v,E,e=0,f=0,t=0,q,k,d,w,c,a="\u7acb\u5373\u652f\u4ed8",s=false,z=["\u652f\u4ed8\u5b9d","\u7f51\u94f6\u652f\u4ed8","\u8d27\u5230\u4ed8\u6b3e","\u9000\u6362\u8d27","\u5feb\u6377\u652f\u4ed8","","\u8d22\u4ed8\u901a","\u534e\u4e3a\u652f\u4ed8","\u7ebf\u4e0b\u652f\u4ed8"],x=$("#colid").val(),B=(x==1&&l.isHisData==1)?"?isHisData=1":"",k=l.paymentList||[];if(k.length>0){w="66";c="BALANCE";for(var A=0;A<k.length;A++){if(k[A].paymentMethod!="BALANCE"&&k[A].paymentType!="66"){w=k[A].paymentType;c=k[A].paymentMethod}}}_showPaymentText=function(g,b){g=parseInt(g,10);if(!g||g<1||!b){return""}if(b=="BALANCE"&&g=="66"){return"\u4ee3\u91d1\u5238\u652f\u4ed8"}if(g==17){return"\u5fae\u4fe1\u652f\u4ed8"}if(g==58){return"\u4e2d\u884c\u5206\u671f\u4ed8\u6b3e"}if(g==59){return"\u62db\u884c\u5206\u671f\u4ed8\u6b3e"}if(g==1&&b=="HB"){return"\u82b1\u5457\u652f\u4ed8"}return z[g-1]};q=l.bundlerList||[];d=l.productList||[];if(l.paymentStatus==3){a="\u652f\u4ed8\u4f59\u6b3e"}if(q.length>0){for(var A=0;A<q.length;A+=1){e=e+q[A].productList.length}}if(d.length>0){f=d.length;for(var A=0;A<f;A+=1){if(d[A].giftList){t+=d[A].giftList.length}}}var o=0,n=0,m=0,h="";for(var A=0;A<q.length;A+=1){E=q[A];o=E.productList.length;for(var C=0;C<o;C+=1){var v=E.productList[C];if(v.giftList&&v.giftList.length>0){m=v.giftList.length;n=n+m;for(var D=0;D<m;D+=1){var u=v.giftList[D];h+='<tr><td class="col-pro-img"><p class="p-img">';h+='<a title="'+u.giftName+'" href="/product/'+u.productId+".html#"+u.giftSkuId+'" target="_blank" >';if(u.photoPath){h+='<img class="nocomment-'+u.skuCode+'" alt="'+u.giftName+'" src="'+ec.mediaPath+"/"+u.photoPath+"100_100_"+u.photoName+'"/>'}else{h+='<img class="nocomment-'+u.giftSkuCode+'" alt="" src=""/>'}h+='</a></p><s class="p-tag"><i class="tag-accessory"></i></s>';h+='</td><td class="col-pro-info"><p class="p-name">';h+='<a class="nocomment-'+u.giftSkuCode+'"title="'+u.giftName+'" href="/product/'+u.productId+".html#"+u.giftSkuId+'" target="_blank">'+u.giftName+"</a>";h+='</p></td><td class="col-price">--</td>';h+='<td class="col-quty">'+u.quantity+"</td></tr>"}}}for(var y=0;y<o;y+=1){v=E.productList[y];r.push('<tr><td class="col-pro-img"><p class="p-img">');r.push('<a title="'+v.skuName+'" href="/product/'+v.productId+".html#"+v.skuId+'" target="_blank">');if(v.photoPath){r.push('<img class="nocomment-'+v.skuCode+'" alt="'+v.skuName+'" src="'+ec.mediaPath+v.photoPath+"100_100_"+v.photoName+'"/>')}else{r.push('<img class="nocomment-'+v.skuCode+'" alt="" src=""/>')}r.push('</a></p></td><td class="col-pro-info"><p class="p-name">');r.push('<b>[\u5957\u9910]</b><a class="nocomment-'+v.skuCode+'"title="'+v.skuName+'" target="_blank" href="/product/'+v.productId+".html#"+v.skuId+'">'+v.skuName+"</a>");r.push('</p></td><td class="col-price"><em>&yen;</em><span>');r.push((v.unitPrice||0).toFixed(2));r.push("</span></td>");if(y==0){r.push('<td class="col-quty" rowspan="'+o+'">'+E.quantity+"</td>");if(A==0){r.push('<td rowspan="'+(e+f+t+n)+'" class="col-pay">');r.push("<em>&yen;</em><span>"+l.cashPay.toFixed(2)+"</span>");if(k.length>0){r.push("<p><em>"+_showPaymentText(w,c)+"</em></p>")}r.push("</td>");if(l.orderStatus<5||l.orderStatus>7){r.push('<td rowspan="'+(e+f+t+n)+'" class="col-operate">');if(l.orderStatus==8){}else{if(l.orderStatus==4){if(l.type==19){r.push('<p class="p-link"><a href="/member/updateToOrder-'+l.orderCode+'">\u4fee\u6539\u8ba2\u5355</a></p>');r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}else{if(l.orderStatus==12){}else{if(l.type&&l.type==3){}else{if(x==0||l.isHisData!=1){if(l.payFlag&&l.payFlag==1){if(l.type==18){if(l.paymentStatus==2){r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>\u652f\u4ed8\u8ba2\u91d1</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==0){r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>\u652f\u4ed8\u5c3e\u6b3e</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==1){r.push('<p class="p-button"><a class="button-operate-pay-disabled" href="javascript:;"><span>\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u672a\u5230</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==2){r.push('<p class="p-button"><a class="button-operate-pay-disabled" href="javascript:;"><span>\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u5df2\u8fc7</span></a></p>')}}}}}else{r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>');r.push(a);r.push("</span></a></p>")}}if(l.type!=14){if(l.type!=5){r.push('<p class="p-link"><a href="/member/updateToOrder-'+l.orderCode+'">\u4fee\u6539\u8ba2\u5355</a></p>')}if(l.type!=3&&l.type!=17){r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}else{if(l.paymentStatus==2){r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}}}}}}r.push('<p class="p-link"><a href="/member/order-'+l.orderCode+'">\u8ba2\u5355\u8be6\u60c5</a></p>');r.push("</td>")}}}if(l.orderStatus>=5&&l.orderStatus<=7){r.push('<td class="col-operate">');if(l.shopCode=="VMALL-HUAWEIDEVICE"&&l.orderStatus==6){}if(x==0||l.isHisData!=1){if(v.productType!=2&&l.type!=12&&l.type!=14&&l.type!=3&&l.orderStatus==7){r.push('<p class="p-link"><a href="javascript:;" data-href="/member/exchange/get-'+l.orderCode+'" onclick="ec.member.orderList.exchangeTip(this,'+l.orderCode+')">\u9000\u6362\u8d27</a></p>')}}r.push('<p class="p-link"><a href="/member/order-'+l.orderCode+'">\u8ba2\u5355\u8be6\u60c5</a></p>');r.push("</td>")}r.push("</tr>")}}if(h){r.push(h)}for(var A=0;A<d.length;A++){v=d[A];o=(v.giftList)?(v.giftList.length+1):1;r.push('<tr><td class="col-pro-img"><p class="p-img">');r.push('<a title="'+v.skuName+'" href="/product/'+v.productId+".html#"+v.skuId+'" target="_blank">');if(v.photoPath){r.push('<img class="nocomment-'+v.skuCode+'" alt="'+v.skuName+'" src="'+ec.mediaPath+v.photoPath+"100_100_"+v.photoName+'"/>')}else{r.push('<img class="nocomment-'+v.skuCode+'" alt="" src=""/>')}r.push('</a></p></td><td class="col-pro-info"><p class="p-name">');r.push('<a title="'+v.skuName+'" target="_blank" ');r.push('class="nocomment-'+v.skuCode+'"href="/product/'+v.productId+".html#"+v.skuId+'">'+v.skuName+"</a>");r.push('</p></td><td class="col-price">');r.push("<em>&yen;</em><span>");if(l.type==18&&l.balanceAmount==null){r.push("--")}else{r.push((v.unitPrice||0).toFixed(2))}r.push('</span></td><td class="col-quty">');r.push(v.quantity+"</td>");if(0>=e){if(A==0){r.push('<td rowspan="'+(f+t)+'" class="col-pay">');r.push("<p><em>&yen;</em><span>");if(l.type==18){r.push(l.paymentAmountTotal.toFixed(2)+"</span></p>")}else{r.push(l.cashPay.toFixed(2)+"</span></p>")}if(k.length>0){r.push("<p><em>"+_showPaymentText(w,c)+"</em></p>")}r.push("</td>")}if(A==0&&(l.orderStatus<5||l.orderStatus>7)){r.push('<td rowspan="'+(f+t)+'" class="col-operate">');if((l.paymentType==1||l.paymentType==2||l.paymentType==5)&&l.paymentStatus==2&&l.orderStatus!=4&&l.orderStatus!=8){}if(l.orderStatus==8){}else{if(l.orderStatus==4){if(l.type==19){r.push('<p class="p-link"><a href="/member/updateToOrder-'+l.orderCode+'">\u4fee\u6539\u8ba2\u5355</a></p>');r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}else{if(l.orderStatus==12){}else{if(l.type&&l.type==3){}else{if(x==0||l.isHisData!=1){if(l.payFlag&&l.payFlag==1){if(l.type==18){if(l.paymentStatus==2){r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>\u652f\u4ed8\u8ba2\u91d1</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==0){r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>\u652f\u4ed8\u5c3e\u6b3e</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==1){r.push('<p class="p-button"><a class="button-operate-pay-disabled" href="javascript:;"><span>\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u672a\u5230</span></a></p>')}else{if(l.paymentStatus==3&&l.isBalancePayStart==2){r.push('<p class="p-button"><a class="button-operate-pay-disabled" href="javascript:;"><span>\u5c3e\u6b3e\u652f\u4ed8\u65f6\u95f4\u5df2\u8fc7</span></a></p>')}}}}}else{r.push('<p class="p-button"><a class="button-operate-pay" href="/payment/order-'+l.orderCode+'"><span>');r.push(a);r.push("</span></a></p>")}}if(l.type!=14){if(l.type!=5){r.push('<p class="p-link"><a href="/member/updateToOrder-'+l.orderCode+'">\u4fee\u6539\u8ba2\u5355</a></p>')}if(l.type!=3&&l.type!=17){r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}else{if(l.paymentStatus==2){r.push('<p class="p-link"><a href="javascript:;" data-ordercode="'+l.orderCode+'" onclick="ec.member.orderList.cancel(this, '+l.paymentStatus+","+l.type+');">\u53d6\u6d88\u8ba2\u5355</a></p>')}}}}}}}r.push('<p class="p-link"><a href="/member/order-'+l.orderCode+'">\u8ba2\u5355\u8be6\u60c5</a></p>');r.push("</td>")}}if(l.orderStatus>=5&&l.orderStatus<=7){r.push('<td rowspan="'+o+'" class="col-operate">');if(l.shopCode=="VMALL-HUAWEIDEVICE"&&l.orderStatus==6){}if(x==0||l.isHisData!=1){if(v.productType!=2&&l.type!=12&&l.type!=14&&l.type!=3&&l.orderStatus==7){r.push('<p class="p-link"><a href="javascript:;" data-href="/member/exchange/get-'+l.orderCode+'" onclick="ec.member.orderList.exchangeTip(this,'+l.orderCode+')">\u9000\u6362\u8d27</a></p>')}}r.push('<p class="p-link"><a href="/member/order-'+l.orderCode+'">\u8ba2\u5355\u8be6\u60c5</a></p>');r.push("</td>")}r.push("</tr>");if(v.giftList&&v.giftList.length>0){r.push(ec.member.orderList.giftList(v.giftList))}}return r.join("")};ec.member.orderList.giftList=function(c){var b=[];for(var a=0;a<c.length;a++){gif=c[a];b.push('<tr><td class="col-pro-img"><p class="p-img">');b.push('<a title="'+gif.giftName+'" href="/product/'+gif.productId+".html#"+gif.giftSkuId+'" target="_blank" >');if(gif.photoPath){b.push('<img class="nocomment-'+gif.skuCode+'" alt="'+gif.giftName+'" src="'+ec.mediaPath+gif.photoPath+"100_100_"+gif.photoName+'" />')}else{b.push('<img class="nocomment-'+gif.giftSkuCode+'" alt="" src="" />')}b.push('</a></p><s class="p-tag"><i class="tag-accessory"></i></s>');b.push('</td><td class="col-pro-info"><p class="p-name">');b.push('<a class="nocomment-'+gif.skuCode+'"title="'+gif.giftName+'" href="/product/'+gif.productId+".html#"+gif.giftSkuId+'" target="_blank">'+gif.giftName+"</a>");b.push('</p></td><td class="col-price">--</td><td class="col-quty">');b.push(gif.quantity+"</td></tr>")}return b.join("")};ec.member.orderList.skuList=function(c){var b=[];if(c!=null&&c.length>0){for(var a=0;a<c.length;a+=1){b.push("<em>"+c[a]+"</em>")}}return b.join("")};ec.member.orderList.depositList=function(a){var b=[];b.push('<div class="o-deposit">');b.push('<table border="0" cellpadding="0" cellspacing="0">');b.push('<tbody><tr><td class="col-deposit"><p class="d-name">\u9636\u6bb51\uff1a\u8ba2\u91d1</p></td>');b.push('<td class="col-price"><em>\u00a5</em><span>'+(a.depositAmount/a.depositProductQuantity).toFixed(2)+"</span></td>");b.push('<td class="col-quty">'+a.depositProductQuantity+"</td>");b.push('<td class="col-pay"><em>\u00a5</em><span>'+a.depositAmount.toFixed(2)+"</span></td>");if(a.paymentStatus==2){b.push('<td class="col-operate">\u672a\u652f\u4ed8</td>')}else{b.push('<td class="col-operate">\u5df2\u652f\u4ed8</td>')}b.push('</tr><tr class="disabled">');b.push('<td class="col-deposit">\u9636\u6bb52\uff1a\u5c3e\u6b3e('+a.balanceStartTime+"\u81f3"+a.balanceEndTime+"\u652f\u4ed8)</td>");b.push('<td class="col-price"><em>\u00a5</em><span>');if(null!=a.balanceAmount){b.push((a.balanceAmount/a.depositProductQuantity).toFixed(2))}else{b.push("--")}b.push("</span></td>");b.push('<td class="col-quty">'+a.depositProductQuantity+"</td>");b.push('<td class="col-pay"><em>\u00a5</em><span>');if(null!=a.balancePay){b.push(a.balancePay.toFixed(2))}else{b.push("--")}b.push("</span></td>");if(a.paymentStatus==1){b.push('<td class="col-operate">\u5df2\u652f\u4ed8</td>')}else{if(a.paymentStatus==2){b.push('<td class="col-operate">\u5f85\u652f\u4ed8</td>')}else{if(a.isBalancePayStart==0){b.push('<td class="col-operate">\u5f85\u652f\u4ed8</td>')}else{if(a.isBalancePayStart==1){b.push('<td class="col-operate">\u652f\u4ed8\u65f6\u95f4\u672a\u5230</td>')}else{if(a.isBalancePayStart==2){b.push('<td class="col-operate">\u652f\u4ed8\u65f6\u95f4\u5df2\u8fc7</td>')}}}}}b.push("</tr></tbody></table></div>");return b.join("")};ec.member.orderList.exchangeTip=function(a){new ec.box($("#exchange-agreement").val(),{boxclass:"ol_box_4 ol_box_agreement",title:"\u9000\u6362\u8d27\u529e\u7406\u534f\u8bae",width:678,height:350,autoHeight:false,onok:function(){location.href=$(a).attr("data-href")}}).open()};ec.member.orderList.exchangeTip=function(b,a){$.ajax({type:"POST",url:"/member/exchange/getReturnExchangeFlag.json",data:{orderCode:a},async:false,dataType:"json",success:function(c){if(null!=c&&c.success){var d=c.returnExchangeFlag;if(d==0){new ec.box($("#exchange-timeout").val(),{boxclass:"ol_box_4",width:528,height:300,autoHeight:false,showButton:false}).open()}else{new ec.box($("#exchange-agreement").val(),{boxclass:"ol_box_4 ol_box_agreement",title:"\u9000\u6362\u8d27\u529e\u7406\u534f\u8bae",width:678,height:350,autoHeight:false,onok:function(){location.href=$(b).attr("data-href")+"/"+d}}).open()}}else{alert("\u83b7\u53d6\u8bf7\u6c42\u5931\u8d25");return false}}})};ec.member.orderList.cancel=function(e,c,d){var b=$(e).attr("data-ordercode");var a=function(f){if(f){f.close()}new ec.ajax().get({url:"/member/cancelOrder-"+b+".json",timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(j){if(!j.success){ec.showError(j);return}var i=[],k=j.order;var g=$(e).closest("td").html("<p class='p-link'><a href='/member/order-"+k.code+"' >\u8ba2\u5355\u8be6\u60c5</a></p>").closest(".list-group-item");var h=g.find(".o-info");h.find(".col-state").html("\u5df2\u53d6\u6d88");i.push('<div class="col-info">');if((k.paymentStatus==2||k.paymentStatus==3)&&(k.orderStatus==3||(k.orderStatus<3&&k.orderSource!=2))){i.push('<input type="checkbox" class="checkbox" name="payCheck" paymentStatus="'+k.paymentStatus+'" value="'+k.orderCode+'"/>')}i.push('<span class="o-date">');i.push(new Date(k.orderDate).format("yyyy-MM-dd HH:mm"));i.push('</span><span class="o-no">');i.push('\u8ba2\u5355\u53f7\uff1a<a href="/member/order-'+k.code+'" title="'+k.code+'">'+k.code+'</a></span></div><div class="col-state">\u5df2\u53d6\u6d88</div></div>');h.html(i.join(""));return}})};if(c==1){new ec.box($("#delAlert-tpl").val(),{boxclass:"ol_box_4",boxid:"orderDelBox",width:600,modal:true,showButton:false,onok:a,oncancel:function(f){f.close()}}).open()}else{if(c==3){if(d==18){if(ec.ui.confirm(e,"\u60a8\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f\u53d6\u6d88\u540e\u8ba2\u91d1\u8d44\u683c\u4e5f\u4f1a\u88ab\u53d6\u6d88\uff01")){a()}}else{if(ec.ui.confirm(e,"\u60a8\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f")){a()}}}else{if(ec.ui.confirm(e,"\u60a8\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f")){a()}}}ec.member.orderList.orderCount()};ec.member.orderList.seltime=function(g,c){if($(g).parent("li").hasClass("current")){return}$("#colid").val(c);$("#checkid").val("all");$("#myOrder-cate li").removeClass("current");$("#myOrder-cate li:first").addClass("current");$(g).parent("li").addClass("current").siblings().removeClass("current");var a={pageNumber:1},d=$("#count-seltime-2").attr("data-num"),b=$("#count-seltime-3").attr("data-num"),f=$("#nocommentNum").attr("data-num"),e=$("#nocommentNum").attr("data-his");ec.member.orderList.load(a,c);if(c==1){$("#nocommentNum").text(e);if(e>0){$("#nocommentNum").show()}else{$("#nocommentNum").hide()}$("#count-seltime-2").text(0).closest("li").hide();$("#count-seltime-3").text(0).closest("li").hide()}else{$("#count-seltime-2").text(d).closest("li").show();if(d>0){$("#count-seltime-2").show()}else{$("#count-seltime-2").hide()}$("#count-seltime-3").text(b).closest("li").show();if(b>0){$("#count-seltime-3").show()}else{$("#count-seltime-3").hide()}$("#nocommentNum").text(f);if(f>0){$("#nocommentNum").show()}else{$("#nocommentNum").hide()}}};ec.member.orderList.check=function(c,b){if($(c).parent("li").hasClass("current")){return}$("#checkid").val(b);$(c).parent("li").addClass("current").siblings().removeClass("current");var a={pageNumber:1};ec.member.orderList.load(a,b)};ec.member.orderList.renderPage=function(a){if(a.totalPage==1){$("#list-pager").hide();return}else{$("#list-pager").show()}$("#list-pager").pager({pageNumber:a.pageNumber,pageCount:a.totalPage,pageSize:5,text:{first:"|&lt;",pre:"&lt",next:"&gt;",last:"&gt;|"},item:["first","pre","qpage","next","last","quickPager"],callBack:ec.member.orderList.load})};ec.member.orderList.openLog=function(e,c){var b="/member/logisticslog.json",f=ec.member.orderList,d=$("#interface-dialog-"+c),a=$("#interface-msg-"+c);new ec.ajax().get({url:b,data:{orderCode:c},timeout:10000,timeoutFunction:function(){a.html('<div class="o-logistics-list-loading">\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01</div>')},successFunction:function(g){if(!g.success){a.html('<div class="o-logistics-list-loading">\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01</div>');return}if((null!=g.logisticsLogList)&&(g.logisticsLogList.length>0)){a.html(ec.member.orderList.interfaceTpl.parse("interface",g.logisticsLogList))}else{a.html('<div class="o-logistics-list-empty">\u6682\u65e0\u7269\u6d41\u4fe1\u606f</div>')}$(".o-logistics tbody tr:first").addClass("tr-latest")}})};ec.member.orderList.confirmDelivery=function(c,a,b){new ec.box($("#box-confirm").val(),{boxclass:"ol_box_4",width:600,title:"\u786e\u8ba4\u6536\u8d27\u6210\u529f",showButton:false,onok:function(d){new ec.ajax().get({url:"/member/confirmDelivery-"+a+".json",timeout:10000,timeoutFunction:function(){alert("\u8bfb\u53d6\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(e){if(!e.success){ec.showError(e);return}$(c).hide();d.setTitle("\u6e29\u99a8\u63d0\u793a");d.setContent($("#box-pj").val());d.setPosition()},errorFunction:function(){alert("\u786e\u8ba4\u6536\u8d27\u5931\u8d25\uff01")}})}}).open()};ec.member.orderList.tapcheckAll=function(){if($("#checkAllBox").is(":checked")){$("input[name='payCheck']").each(function(){this.checked=true});$("#bottomCheckAllBox").attr("checked",true)}else{$("input[name='payCheck']").each(function(){this.checked=false});$("#bottomCheckAllBox").attr("checked",false)}};ec.member.orderList.mergePay=function(){var b=true;var a="";$("input[name='payCheck']").each(function(){if(this.checked){b=false;a+=$(this).val()+"|"}});if(b){alert("\u8bf7\u9009\u62e9\u8981\u5408\u5e76\u4ed8\u6b3e\u7684\u8ba2\u5355");return}window.location.href="/payment/order-"+a};ec.member.orderList.orderCount=function(){new ec.ajax().get({url:domainMain+"/member/orderCount.json?t="+new Date().getTime(),async:false,timeout:10000,successFunction:function(a){if(!a.success){return}$("#count-seltime-2").text(a.orderCount.unpaidOrderCount?a.orderCount.unpaidOrderCount:0);$("#count-seltime-2").attr("data-num",a.orderCount.unpaidOrderCount?a.orderCount.unpaidOrderCount:0);$("#count-seltime-3").text(a.orderCount.unreceiptOrderCount?a.orderCount.unreceiptOrderCount:0);$("#count-seltime-3").attr("data-num",a.orderCount.unreceiptOrderCount?a.orderCount.unreceiptOrderCount:0);countSeltime0=parseInt($("#count-seltime-2").html())+parseInt($("#count-seltime-3").html());if(countSeltime0>0){$("#count-seltime-0").text(countSeltime0).show()}else{$("#count-seltime-0").text(0).hide()}var b=countSeltime0;if(b>0){$("#li-order span").html("\u6211\u7684\u8ba2\u5355<em>"+b+"</em>");ec.util.cookie.set("vmallOrderCount",b)}else{$("#li-order span").html("\u6211\u7684\u8ba2\u5355");ec.util.cookie.set("vmallOrderCount",0)}$("#ec-tab").navMove({boxClass:"ec-tab-arrow"})}})};ec.member.orderList.urlStatus=function(){var a=window.location.href;if(a.search(/unpaid/)!=-1){$("#list-group").html("");var b=$("#myOrder-cate li").eq(1).find("a");ec.member.orderList.check(b,"unpaid")}else{if(a.search(/nocomment/)!=-1){$("#list-group").html("");var b=$("#myOrder-cate li").eq(2).find("a");ec.member.orderList.check(b,"nocomment")}}};ec.member.orderList.payClick=function(){$("input[name='payCheck']").bind("click",function(){if(this.checked){if(this.getAttribute("paymentstatus")=="3"){num++}}else{if(this.getAttribute("paymentstatus")=="3"){num--}}if(num==0){$("#topButton").attr("class","button-operate-merge-pay");$("#bottomButton").attr("class","button-operate-merge-pay");$("#topButton").bind("click",function(){ec.member.orderList.mergePay()});$("#bottomButton").bind("click",function(){ec.member.orderList.mergePay()})}else{$("#topButton").attr("class","button-operate-pay-disabled");$("#bottomButton").attr("class","button-operate-pay-disabled");$("#topButton").removeAttr("onclick");$("#topButton").unbind("click");$("#bottomButton").removeAttr("onclick");$("#bottomButton").unbind("click")}})};var num=0;ec.ready(function(){if(ec.isIE6){$(".o-logistics").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}$("#ec-tab").navMove({boxClass:"ec-tab-arrow"});ec.member.orderList.urlStatus();$("#checkAllBox").click(function(){if(this.checked){$("input[name='payCheck']").each(function(a){this.checked=true;if(this.getAttribute("paymentstatus")=="3"){num++}});$("#bottomCheckAllBox").attr("checked",true)}else{num=0;$("input[name='payCheck']").each(function(){this.checked=false});$("#bottomCheckAllBox").attr("checked",false)}if(num==0){$("#topButton").attr("class","button-operate-merge-pay");$("#bottomButton").attr("class","button-operate-merge-pay");$("#topButton").bind("click",function(){ec.member.orderList.mergePay()});$("#bottomButton").bind("click",function(){ec.member.orderList.mergePay()})}else{$("#topButton").attr("class","button-operate-pay-disabled");$("#bottomButton").attr("class","button-operate-pay-disabled");$("#topButton").removeAttr("onclick");$("#topButton").unbind("click");$("#bottomButton").removeAttr("onclick");$("#bottomButton").unbind("click")}});$("#bottomCheckAllBox").click(function(){if(this.checked){$("input[name='payCheck']").each(function(){this.checked=true;if(this.getAttribute("paymentstatus")=="3"){num++}});$("#checkAllBox").attr("checked",true)}else{num=0;$("input[name='payCheck']").each(function(){this.checked=false});$("#checkAllBox").attr("checked",false)}if(num==0){$("#topButton").attr("class","button-operate-merge-pay");$("#bottomButton").attr("class","button-operate-merge-pay");$("#topButton").bind("click",function(){ec.member.orderList.mergePay()});$("#bottomButton").bind("click",function(){ec.member.orderList.mergePay()})}else{$("#topButton").attr("class","button-operate-pay-disabled");$("#bottomButton").attr("class","button-operate-pay-disabled");$("#topButton").removeAttr("onclick");$("#topButton").unbind("click");$("#bottomButton").removeAttr("onclick");$("#bottomButton").unbind("click")}});$("input[name='payCheck']").bind("click",function(){if(this.checked){if(this.getAttribute("paymentstatus")=="3"){num++}}else{if(this.getAttribute("paymentstatus")=="3"){num--}}if(num==0){$("#topButton").attr("class","button-operate-merge-pay");$("#bottomButton").attr("class","button-operate-merge-pay");$("#topButton").bind("click",function(){ec.member.orderList.mergePay()});$("#bottomButton").bind("click",function(){ec.member.orderList.mergePay()})}else{$("#topButton").attr("class","button-operate-pay-disabled");$("#bottomButton").attr("class","button-operate-pay-disabled");$("#topButton").removeAttr("onclick");$("#topButton").unbind("click");$("#bottomButton").removeAttr("onclick");$("#bottomButton").unbind("click")}});ec.member.orderList.orderCount()});
